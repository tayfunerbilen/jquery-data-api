const $state={};let $watchStates=!0,$debug=!1;const setWatchStates=function(t){$watchStates=t};$debug&&(window.onerror=function(t){const e=$("<div>");e.css({backgroundColor:"red",position:"fixed",bottom:0,left:0,width:"100%",zIndex:"999999",color:"#fff",padding:"15px"}).html(t),e.appendTo("body")});const stateUpdateDepth=(t,e)=>{const a=t.split(".");return a.length>1?$state[a[0]][a[1]]=e:$state[t]=e},stateCheckDepth=(t,e)=>{const a=t.split(".");return a.length>1?$state[a[0]][a[1]]:$state[t]},setState=function(t,e){const a=$state[t];stateUpdateDepth(t,e),setStateEvent(t,e,a),updateDom(t,e),watchExpressions()},updateState=function(t,e){const a=$state[t];stateUpdateDepth(t,e),updateDom(t,e),setStateEvent(t,e,a),watchExpressions()},updateDom=function(name,value){let el;for(v in value){$.isNumeric(v)||(el=$('[data-state="'+name+"."+v+'"]'),value=eval("$state."+name+"."+v)),el||(el=$('[data-state="'+name+'"]')),el.is("input:not(:checkbox):not(:radio):not(:file)")&&el.val(value),el.prop("tagName")==="TEXTAREA"&&el.val(value),el.is(":checkbox")&&el.prop("checked",value),el.is(":radio")&&el.prop("checked",value),el.is(":file")&&el.val(value),el.is("select")&&(el.attr("multiple")&&typeof value=="object"?el.find("option").each(function(){(value.includes($(this).val())||value.includes(parseFloat($(this).val())))&&$(this).attr("selected","selected")}):el.find('option[value="'+value+'"]').attr("selected","selected"));const forLoopBlock=$('[data-for="'+name+'"]');if(forLoopBlock.length){let template=forLoopBlock.find("template").clone();forLoopBlock.html("").append(template),$.each(value,function(key,item){eval("var "+forLoopBlock.data("as")+" = "+JSON.stringify(item)+";");let template=forLoopBlock.find("template").html();template=template.replaceAll(/\{(.*?)\}/g,function(match,contents){return contents=contents.replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<"),typeof eval(contents)=="object"?JSON.stringify(eval(contents)).replaceAll('"',"'"):eval(contents)}),forLoopBlock.append(template)})}}},watchStates=function(){$(document).off("keyup keypress input","[data-input]").on("keyup keypress input","[data-input]",function(){let t=$(this).data("state"),e=$(this).val();e.match(/^[0-9\.\,]+$/)&&(e=parseFloat(e)),stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())}),$(document).off("keyup keypress input","[data-textarea]").on("keyup keypress input","[data-textarea]",function(){let t=$(this).data("state"),e=$(this).val();e.match(/^[0-9\.\,]+$/)&&(e=parseFloat(e)),stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())}),$(document).off("change","[data-checkbox]").on("change","[data-checkbox]",function(){const t=$(this).data("state"),e=$(this).prop("checked");stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())}),$(document).on("change","[data-radio]",function(){const t=$(this).data("state"),e=$(this).val();stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())}),$(document).off("change","[data-file]").on("change","[data-file]",function(){let t=$(this).data("state"),e=$(this)[0].files;$(this).attr("multiple")||(e=e[0]),stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())}),$(document).off("change","[data-select]").on("change","[data-select]",function(){const t=$(this).data("state"),e=$(this).val();typeof e!="object"&&stateCheckDepth(t)!==e&&(setStateEvent(t,e,$state[t]),stateUpdateDepth(t,e),watchExpressions())})},watchExpressions=function(){$("[data-css]").each(function(){const styles={};$.each($(this)[0].dataset,function(key,val){key!=="css"&&key.includes("css")&&(key=key.replace("css",""),key=key.charAt(0).toLowerCase()+key.slice(1),styles[key]=val.match(/[\.\}\$\+\']+/g)?eval(val):val)}),$(this).css(styles)}),$("[data-disabled]").each(function(){const disabled=eval($(this).data("disabled"));disabled?$(this).attr("disabled","disabled"):$(this).removeAttr("disabled")}),$("[data-class]").each(function(){const[condition,className]=eval($(this).data("class"));condition?$(this).addClass(className):$(this).removeClass(className)}),$("[data-text]").each(function(){$(this).html()!==stateCheckDepth($(this).data("text"))&&$(this).html(stateCheckDepth($(this).data("text")))}),$("[data-attribute]").each(function(){let[attribute,code]=eval($(this).data("attribute"));code&&(code=code.replaceAll(/\$\{(.*?)\}/g,"###$1###"),code=code.replaceAll(/\{(.*?)\}/gsu,function(expression,content){return content=content.replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll(/###(.*?)###/g,"${$1}"),eval(content)}.bind(this)),$(this).attr(attribute,code))}),$("[data-expression]").each(function(){const expression=eval($(this).data("expression"));$(this).html(expression)}),$("[data-show]").each(function(){const condition=eval($(this).data("show")),effectFade=$(this).data("fade"),effectSlide=$(this).data("slide");condition?effectFade?$(this).fadeIn(effectFade):effectSlide?$(this).slideDown(effectSlide):$(this).show():effectFade?$(this).fadeOut(effectFade):effectSlide?$(this).slideUp(effectSlide):$(this).hide()})},stateEffect=function(t,e=!1){e?$.each(e,(a,s)=>{$(document).on(s,function(n,i,l){t(i,l,s)})}):t()},updateBlocks=function(){$("[data-block]").each(function(){let html=$(this).html();html=html.replaceAll(/\$\{(.*?)\}/g,"###$1###"),html=html.replaceAll(/\{(.*?)\}/gsu,function(expression,content){return content=content.replaceAll("&amp;","&").replaceAll("&gt;",">").replaceAll("&lt;","<").replaceAll(/###(.*?)###/g,"${$1}"),content.match(/[\?\&\=\s\+\(\)]+/g)?`<span data-expression="${content}">${eval(content)}</span>`:`<span data-text="${content.replace("$state.","")}">${eval(content)}</span>`}),$(this).html(html)})},setDomStates=function(){$("[data-states]").each(function(){const states=eval("JSON.parse(JSON.stringify("+$(this).data("states")+"))");for(state in states)$state[state]=states[state]}),$("[data-state]").each(function(){const name=$(this).data("state"),nameSplited=name.split(".");let value=$(this).data("value")?eval($(this).data("value")):null;var _state;nameSplited.length>1?(typeof $state[nameSplited[0]]=="undefined"&&($state[nameSplited[0]]={}),_state=$state[nameSplited[0]][nameSplited[1]]=value):_state=$state[name],$(this).is("input:not(:checkbox):not(:radio):not(:file)")&&(value=$(this).val()||null,value&&value.match(/^[0-9\.\,]+$/)&&(value=parseFloat(value)),$(this).attr("data-input",""),_state&&$(this).val(_state)),$(this).is(":checkbox")&&(value=$(this).prop("checked")||!1,_state&&$(this).prop("checked",_state),$(this).attr("data-checkbox","")),$(this).is(":radio")&&(value||(value=$(this).filter(":checked").val()||!1),_state&&$(this).prop("checked",_state),$(this).attr("data-radio","")),$(this).prop("tagName")==="TEXTAREA"&&(value=$(this).val()||null,value&&value.match(/^[0-9\.\,]+$/)&&(value=parseFloat(value)),$(this).attr("data-textarea",""),_state&&$(this).val(_state)),$(this).is(":file:not([data-custom])")&&(value=!1,$(this).attr("data-file","")),$(this).is("select")&&($(this).attr("multiple")?value=$(this).val():value=$("option:selected:not(:disabled)",this).val()||null,_state&&(typeof _state=="object"?$.each(_state,function(t,e){$(this).find('option[value="'+e+'"]').prop("selected",!0)}.bind(this)):$(this).find('option[value="'+_state+'"]').attr("selected","selected")),$(this).attr("data-select","")),_state||(nameSplited.length>1?$state[nameSplited[0]][nameSplited[1]]=value:$state[name]=value),setStateEvent(name,value,value)})},setStateEvent=function(t,e,a){$(document).trigger(t,[e,a])},getState=function(t){return $state[t]},dataApiInit=()=>{setDomStates(),updateBlocks(),$watchStates&&watchStates(),watchExpressions()};dataApiInit(),$(document).trigger("jq-data-api");
